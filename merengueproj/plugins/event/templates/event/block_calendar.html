{% extends "block.html" %}

{% block blockbody %}
  <span id="eventsCalendar" class="calendar" style="font-size:73%;"></span>

<link href="{{ MEDIA_URL }}merengue/css/jquery-ui-1.8.css" rel="stylesheet" type="text/css"/>
<script src="{{ MEDIA_URL }}merengue/js/jquery-ui-1.8.min.js"></script>
<script language="javascript" src="{{ MEDIA_URL }}merengue/js/jquery.ui.datepicker-{{ LANGUAGE_CODE }}.js"></script>

<script language="javascript" >
;(function($) {
    $(document).ready(function() {
        var datepickerOptions, eventDate;
        eventDate = {};
        {% for date, event in events_dic.items %}
        eventDate["{{ date }}"] = {
            'name': [true, "calendarEventDay", "{{ event.name|join:" / " }}"],
            'url': '{{ event.url }}'
        }
        {% endfor %}
        datepickerOptions = {
            changeMonth: true,
            changeYear: true,
            beforeShowDay: function(date) {
                var key;
                key = date.getFullYear() +"-"+ (date.getMonth() + 1) +"-"+ date.getDate();
                if (eventDate[key] && eventDate[key]['name'])
                    return [true, "calendarEventDay", "{{ event.name|join:" / " }}"];
                else
                    return [false, "", ""];
            },
            onSelect: function(dateText, inst) {
                var date, key;
                var date_splitted = dateText.split('/');
                date = new Date(parseInt(date_splitted[2]),
                                parseInt(date_splitted[1]) - 1,
                                parseInt(date_splitted[0]));
                key = date.getFullYear() +"-"+ (date.getMonth() + 1) +"-"+ date.getDate();
                if (eventDate[key]) {
                    window.location = eventDate[key]['url'];
                }
            },
            onChangeMonthYear: function(year, month, inst) {
                $.ajax({
                    url: "{% url events_calendar %}",
                    type: "GET",
                    data: ({month: month, year: year}),
                    dataType: "json",
                    success: function(events) {
                        eventDate = events;
                        $("#eventsCalendar").datepicker("refresh");
                    }
                });
            }
        };
        $("#eventsCalendar").datepicker(datepickerOptions);
    });
})(jQuery);


</script>



{% endblock %}

