{% extends "filebrowser/base.html" %}
{% load i18n thumbnail truncate_filter filebrowser_tags %}

{% block extrahead %}
<style type="text/css" media="all">
<!--

-->
</style>

{% endblock %}

{% block pagetitle %}{% trans "Document detail" %}{% endblock %}

{% block extrabreadcrumbs %}
  {{ block.super }}
  <span class="breadcrumbSeparator">â†’</span><a href=".">{{ document.title }}</a>
{% endblock %}

{% block content %}
<div id="content-title">
    <h1 title="{{ document.title }}">{{ document.title }}</h1>
</div>

<div class="object-buttons">
{% if user.is_superuser %}
<a href="{% filebrowser_url webfs.views.editdoc repository_name=repository.name,doc_slug=document.slug %}"><img src="{{ MEDIA_URL }}filebrowser/img/document-text-editor.png" /> {% trans "Edit" %}</a><span>&nbsp;</span>
{% endif %}
</div>

<div id="webfs-document-view">
{{ document.content|safe }}

<form id="removeattachmentform"  action="" method="post" style="display:none">
<!-- empty form to be filled for ajax request and csrf middleware -->
</form>

<h2>{% trans "Files" %}</h2>
{% for file in doc_files %}
  <div class="file" id="file-{{file.id}}">
    <div>
    <img alt="{% trans file %}" src="/site_media/img/file.png" />
    <a href="{{ file.file.url }}">{{ file.file.name|inline_truncate:18 }}</a>
    <span>{{ file.file.size|filesizeformat }}
    </div>
    {# {% if perms.webfs.delete_filedocument %} #}
    {% if request.user.is_superuser %}
    <div>
      <button onclick="javascript:removeAttachment('{% filebrowser_url webfs.views.root repository_name=repository.name %}', 'file', {{file.id}})">{% trans "Remove" %}</button></span>
    </div>
    {% endif %}
  </div>
{% endfor %}

{% if perms.webfs.add_filedocument %}
<div class="addlink">
  <button id="filebtn" onclick="javascript:showForm('file')">{% trans "New file" %}</button>
</div>

<form class="document-form filebrowserForm" id="fileform" method="post" action="." enctype="multipart/form-data">
  <input id="file" name="file" type="file">
  <input type="submit" class="submitButton" id="addfile" name="addfile" value="{% trans 'Add file' %}"/>
  <button type="button" onclick="javascript:hideForm('file')">{% trans "Cancel" %}</button>
</form>
{% endif %}

<h2>{% trans "Images" %}</h2>
{% for image in doc_images %}
  <div class="image" id="image-{{image.id}}">
    <p>
    {% thumbnail image.file 250x250 as image_thumbnail %}
    <a href="{{ image.file.url }}">
      <img alt="{{ image.file.name }}" src="{{ image_thumbnail.absolute_url }}" />
    </a>
    </p>
    <p>
    <span>{{ image.file.size|filesizeformat }}
        {% if perms.webfs.delete_imagedocument %}
        <button onclick="javascript:removeAttachment('{% filebrowser_url webfs.views.root repository_name=repository.name %}', 'image', {{image.id}})">{% trans "Remove" %}</button>
    </span>
    {% endif %}
    </p>
  </div>
{% endfor %}

{% if perms.webfs.add_imagedocument %}
<div class="addlink">
  <button id="imagebtn" onclick="javascript:showForm('image')">{% trans "New image" %}</button>
</div>

<form class="document-form filebrowserForm" id="imageform" method="post" action="." enctype="multipart/form-data">
  <input id="image" name="image" type="file">
  <input type="submit" class="submitbutton" id="addimage" name="addimage" value="{% trans 'Add image' %}"/>
  <button type="button" onclick="javascript:hideForm('image')">{% trans "Cancel" %}</button>
</form>
</div>
{% endif %}
{% endblock %}
