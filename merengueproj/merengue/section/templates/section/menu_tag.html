{% load mptt_tags smart_if %}
{% if menu %}
    {% for node, structure in menu.get_descendants|tree_info %}
        {% if structure.new_level and node.level > 1 %}
            <ul class="menu_ul menu{% if node.level > 2 %}{{node.level}}{% endif %}">
        {% endif %}
            {% with node.get_absolute_url as node_url %}
                <li id="{{ node.slug }}" class="item {% ifequal node menu_item %}selected{% endifequal %}{% if node in ancestors %}selectedAncestors{% endif %} {% if node.level - menu_item.level > 1 %} itemhidden {% endif %}">
                    <a href="{{ node.get_absolute_url }}">{{ node.name }}</a>
            {% endwith %}
        {% for level in structure.closed_levels %}</li>{% if level > 1 %}</ul>{% endif %}{% endfor %}
    {% endfor %}
{% endif %}
